# 🎌 豊中修猷館ウェブサイト 引継ぎ資料 (Starting Point v1.0.0)

このドキュメントは、豊中修猷館剣道部のウェブサイトおよび管理・部員ポータルの開発を引き継ぐための最終資料です。
本プロジェクトは、**2026年1月21日にバージョン1.0.0**として整理・リリースされました。

---

## 🔐 1. 重要インフラ・アカウント情報

本システムの運営には以下の2つの主要アカウントが使用されています。

| サービス | アカウント名 | 管理内容 |
| --- | --- | --- |
| **Google Drive / Sheets** | `shuyukan.info@gmail.com` | 部員名簿、会計、問い合わせ、出席記録のスプレッドシート |
| **Git / Vercel / Firebase** | `kotani.tatsuhiro@gmail.com` | ソースコード (GitHub)、ホスティング (Vercel)、認証 (Firebase) |

> [!IMPORTANT]
> **構造の理解**: 着手前に必ず [portal-ux-design.md](./docs/portal-ux-design.md) を読み、管理者と部員の権限分離の基本設計を理解してください。

---

## 🏗️ 2. システムアーキテクチャ

本システムは、保守性とコストパフォーマンスを最大化するため、サーバーレスな構成を採用しています。

- **Frontend**: React (Vite) + Tailwind CSS
- **Backend (API)**: Google Apps Script (GAS)
  - 単一のスクリプトファイル [unified_apps_script.gs](./docs/unified_apps_script.gs) ですべてのAPIアクションを管理しています。
- **Database**: Google Sheets
  - スプレッドシートをデータベースとして活用しています。
- **Authentication**: Firebase Authentication
  - Googleログイン等による本人認証を行います。

---

## ✅ 3. 現状の機能一覧 (v1.0.0 成熟度)

### ⚙️ 管理者ポータル

- **承認管理**: 新規入会希望者の確認とワンクリック承認（通知メール自動送信）。
- **お問い合わせ管理**: サイトからの問い合わせ内容の確認。
- **会員名簿管理**: 59名の部員データの閲覧・編集・削除。
- **お知らせ投稿**: サイトおよび部員ポータルへのお知らせ投稿・画像アップロード。
- **出欠・会計**: 日々の稽古の出欠記録および会費の支払い状況管理。

### 👥 部員ポータル

- **マイプロフィール**: 自身の情報の確認・編集（初回ログイン時は入力強制）。
- **ドキュメント閲覧**: 配布資料やマニュアルの閲覧・ダウンロード。
- **行事予定**: Googleカレンダーと連動した稽古スケジュールの確認。

---

## 🧹 4. クリーンアップと整理状況

巻き戻り防止と後任者の混乱を防ぐため、以下の整理を行いました：

- **不要ファイルの削除**: 開発途中のパッチ、古い設計図、冗長なガイドを削除。
- **APIの集約**: 複数のGASファイルを `unified_apps_script.gs` 1つに統合。
- **バージョン刻印**: アプリ内のフッターおよび管理者画面に `v1.0.0` を明記。
- **環境変数の整理**: 本番用のスプレッドシートIDおよび新しいGAS URLへの移行。

---

## ⚠️ 5. 現在の状況・エラー箇所

- **会員名簿の表示**: **新しいURLへの差し替えを完了しました。**
  - ローカル開発時は、`.env` の有効化のためにサーバーの再起動 (`npm run dev`) が必要です。
- **お知らせの画像**: Google Driveの共有設定により、稀に画像が表示されない場合があります。Drive側の直リンク設定の確認が必要です。
- **Googleログイン**: 現在、Google推奨の最新ベストプラクティスに基づいた実装への完全移行を「宿題」としています。

---

## 📝 6. 次のフェーズへの宿題 (TODO)

1. **認証の強化**: Firebase AuthenticationとGoogle APIの整合性を深め、より安全なログインフローを構築する。
2. **操作ログ（監査ログ）**: 管理者が誰を承認したか、いつデータを変更したかのログをスプレッドシートへ記録する機能。
3. **SEO・GEO対策**: AI検索（Perplexity等）に引用されやすいよう、構造化データ (`llms.txt` 等) の整備。
4. **スマホアプリ化の検討**: PWA化により、保護者がホーム画面からワンタップでお知らせを確認できるようにする。

## 8. 管理者の変更・追加手順

将来、管理者が交代したり通知先を増やしたりする場合は、以下の2箇所を修正してください。

### ① 管理ポータルへのアクセス権 (Frontend)

Googleログイン後に「管理者画面」を表示できる人を制御します。
**（v1.1.0より、画面上から設定可能になりました）**

1. 既存の管理者が「会員管理」画面を開く。
2. 対象のメンバーの「編集」ボタンを押す（または新規登録）。
3. **「管理者権限を付与する」** にチェックを入れて保存する。

※ これにより、対象ユーザーのメールアドレスでログインした際に、自動的に管理者メニューが表示されるようになります。
※ 初期管理者（`shuyukan.info@gmail.com`）はコード内でバックアップとして保護されています。

### ② メール通知の宛先 (Backend)

入会申請やお問合せの通知メールが届く人を制御します。

- **ファイル**: `docs/unified_apps_script.gs`（GASエディタ上で直接編集）
- **箇所**: `var ADMIN_EMAILS = "..."` の文字列を編集（カンマ区切りで複数指定可）。
- **反映**: 編集・保存後、GASの**「新しいバージョン」をデプロイ**してください。

> [!WARNING]
> **GASのURLが変わった場合**:
> デプロイによってGASのウェブアプリURLが変更された場合は、**Vercelの管理画面（Settings > Environment Variables）** で `VITE_MEMBER_API_URL` と `VITE_NEWS_API_URL` を新しいURLに更新し、再デプロイする必要があります。

---

後任の方へ：このプロジェクトは部員の皆様の熱意で支えられています。
**豊中修猷館のさらなる発展を祈ります！**
